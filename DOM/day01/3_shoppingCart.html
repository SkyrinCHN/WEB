<!DOCTYPE HTML>
<html>

<head>
  <title>使用Selector API实现购物车客户端计算</title>
  <meta charset="utf-8" />
  <style>
    table {
      width: 600px;
      text-align: center;
      border-collapse: collapse;
    }

    td,
    th {
      border: 1px solid black
    }

    td[colspan="3"] {
      text-align: right;
    }
  </style>

</head>

<body>
  <table id="data">
    <thead>
      <tr>
        <th>商品名称</th>
        <th>单价</th>
        <th>数量</th>
        <th>小计</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>iPhone6</td>
        <td>¥4488.00</td>
        <td>
          <button>-</button>
          <span>1</span>
          <button>+</button>
        </td>
        <td>¥4488.00</td>
      </tr>
      <tr>
        <td>iPhone6 plus</td>
        <td>¥5288.00</td>
        <td>
          <button>-</button>
          <span>1</span>
          <button>+</button>
        </td>
        <td>¥5288.00</td>
      </tr>
      <tr>
        <td>iPad Air 2</td>
        <td>¥4288.00</td>
        <td>
          <button>-</button>
          <span>1</span>
          <button>+</button>
        </td>
        <td>¥4288.00</td>
      </tr>
    </tbody>
    <tfoot>
      <tr>
        <td colspan="3">Total: </td>
        <td>¥14064.00</td>
      </tr>
    </tfoot>
  </table>
  <script>
    //查找table元素
    //查找所有按钮
    var table = document.getElementById("data");
    var btns = table.getElementsByTagName("button");
    console.log(btns);

    //事件:浏览器自动触发的或者用户手动触发的页面内容的状态变化
    //事件处理函数:在事件发生时,自动执行的回调函数
    for (var btn of btns) {
      btn.onclick = function () {
        this.style.color = "red";
        //获得SPAN的内容
        var span = this.parentNode.children[1];
        span.style.color = "red";
        //转为整数
        var n = parseInt(span.innerHTML);
        if (this.innerHTML == "+") {
          n++;
        }
        if (this.innerHTML == "-" && n > 1) {
          n--;
        }
        span.innerHTML = n;
        //修改小计
        //获取当前btn父级的前一个兄弟的内容(单价)
        //去掉前边的¥符号
        var price =parseFloat(this.parentElement.previousElementSibling.innerHTML.slice(1)) ;
        //获得小计价格
        var sub =n*price;
        //修改小计, 拼接成一个字符串 tofixed(2) 保留两位小数
         this.parentElement.nextElementSibling.innerHTML=`¥${sub.toFixed(2)}`;
         //得到每一个tbody>tr>td:last-child 找到每一个小计的元素
         var tds = table.querySelectorAll("tbody>tr>td:last-child");
         console.log(tds);
         //设置总价格初始值为0
         var total = 0;
         //遍历每一个小计价格(去掉前边的¥符号),然后相加等于total
         for(var td of tds){
           total+=parseFloat(td.innerHTML.slice(1));
         }
         //设置tfoot中 tr下标的最后一个td中的内容(总价)样式为 ¥total.00
         table.querySelector("tfoot>tr>td:last-child").innerHTML=`¥${total.toFixed(2)}`;
      }
    }
  </script>
</body>
</html>